<!DOCTYPE html>
<html>
  <head>
  </head>
<body>
<script>
var audioContext = new AudioContext();
function pp( mmldata) {
    let mml = mmldata.text;
    console.log(mml);
    //let mml = "t200 o6 l8 cege [>eg<c]2";
    let config = { context: audioContext };
    let mmlEmitter = new MMLEmitter(mml, config);

    mmlEmitter.on("note", (e) => {
    console.log("NOTE: " + JSON.stringify(e));
    playNote(e);
    });
    mmlEmitter.on("end:all", (e) => {
    console.log("END : " + JSON.stringify(e));
    mmlEmitter.stop();
    });

    mmlEmitter.start();
}

function ppp() {
    var audioContext = new AudioContext();
    var osc  = audioContext.createOscillator(); // 音を出す部品を作る
    var amp  = audioContext.createGain();       // 音量を制御する部品を作る
    var when = audioContext.currentTime;        // 今の時間
  
    // 音を出す部品に周波数 880Hz を設定する
    osc.frequency.value = 880;
    // 波形を三角波にする
    osc.type = "triangle";
    // 音量の制御, 1秒で減衰させる
    amp.gain.setValueAtTime(0.25, when);
    amp.gain.linearRampToValueAtTime(0.0, when + 1.0);
  
    // 音を出す部品を起動させる (鍵盤を押すみたいなイメージ)
    osc.start(when);
  
    // こういう感じで各部品を接続する
    // osc(tri, 880Hz) -> amp(decay, 1sec) -> Web Audio API output
    osc.connect(amp)
    amp.connect(audioContext.destination);
  
    setTimeout(function() {
      // 終わったら接続を解除する
      amp.disconnect();
    }, 1000);
  };
</script>
<script src="js/mml-emitter.js"></script>
<script src="js/mml-sound.js"></script>
<button onclick="ppp()">tone</button>
<button onclick="pp(document.getElementById('mmltext'))"">mml</button>
<script type="text/mml" id="mmltext">
// Turkish March
// W.A.Mozart
t120 q50 v100
/: o4 l16 bag+a>
    c8r8dc<b>c e8r8fed+e bag+abag+a >c4<a8>c8<
    l8 [gb][f+a][eg][f+a] [gb][f+a][eg][f+a] [gb][f+a][eg][d+f+] e4 :/
/: o5 [ce][df] [eg][eg]a16g16f16e16 [<b>d]4[ce][df] [eg][eg]a16g16f16e16 [<b>d]4[<a>c][<b>d]
    [ce][ce] f16e16d16c16 <[g+b]4[a>c][b>d] >[ce][ce]f16e16d16c16 <[g+b]4
    l16 bag+a >c8r8dc<b>c e8r8fed+e bag+abag+a l8>c4<ab >c<bag+ aefd c4<b8.a32b32 a4 :/
;
t120 q50 v80
/: o3 l8 r4
    a>[ce][ce][ce]< a>[ce][ce][ce]< a>[ce]<a>[ce]< a>[ce][ce][ce]<
    e[b>e][b>e][b>e] e[b>e][b>e][b>e] e[b>e]<b>b e4 :/
/: o3 r4 c>c<e>e<g>g<r4 c>c<e>e<g4r4 <a>ac>c<e>e<r4 <a>ac>c<e4r4
    a>[ce][ce][ce]< a>[ce][ce][ce]< a>[ce]<a>[ce]< f[a>d+][a>d+][a>d+]
    e[ae]d[fb] c[ea]d[fb] [ea][ea][eg+][eg+] [<a>a]4 :/
;
</script>

</body>
</html>
